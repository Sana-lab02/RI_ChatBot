import sqlite3
from werkzeug.security import generate_password_hash

conn = sqlite3.connect("retailers.db")
cur = conn.cursor()

cur.execute("""
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT UNIQUE NOT NULL,
  password_hash TEXT NOT NULL,
  role TEXT NOT NULL DEFAULT 'user',
  is_active INTEGER NOT NULL DEFAULT 1,
  created_at TEXT NOT NULL
)
""")

username = "admin"
password = "ChangeMeNow!"
role = "admin"

cur.execute("""
INSERT OR IGNORE INTO users (username, password_hash, role, is_active, created_at)
VALUES (?, ?, ?, 1, datetime('now'))
""", (username, generate_password_hash(password, method="pbkdf2:sha256"), role))

conn.commit()
conn.close()
print("done")
